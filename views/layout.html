<!DOCTYPE html>
<html>
  <title>Trip Planner - {% block title %}{% endblock %}</title>
  <head>
    <link href='http://fonts.googleapis.com/css?family=Varela+Round' rel='stylesheet' type='text/css'>
    <link href="/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/style.css" rel="stylesheet">
  </head>
  <body>

    <div class="navbar navbar-inverse navbar-fixed-top navbar-pad" role="navigation">
      <div class="container-flex">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand clearfix" href="/"><span class="glyphicon glyphicon-map-marker"></span><span>Trip Planner</span></a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="/about">About</a></li>
            <li><a href="/contact">Contact</a></li>
          </ul>
        </div>
      </div>
    </div>

    {% block content %}
    {% endblock %}

    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfQxgWt-LSZcEmTEN8581Uq9SzZHnpuys&sensor=true"></script>
    <script>
      function initialize_gmaps() {
      // initialize new google maps LatLng object
      var myLatlng = new google.maps.LatLng(40.705189,-74.009209);
      // set the map options hash
      var mapOptions = {
        center: myLatlng,
        zoom: 13,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        styles: styleArr
      };
      // get the maps div's HTML obj
      var map_canvas_obj = document.getElementById("map-canvas");
      // initialize a new Google Map with the options
      var map = new google.maps.Map(map_canvas_obj, mapOptions);
      // Add the marker to the map
      var marker = new google.maps.Marker({
        position: myLatlng,
        title:"Hello World!"
      });

      // draw some locations on the map
      // var hotelLocation = [40.705137, -74.007624];
      // var restaurantLocations = [
      //   [40.705137, -74.013940],
      //   [40.708475, -74.010846]
      // ];
      // var activityLocations = [
      //   [40.716291, -73.995315],
      //   [40.707119, -74.003602]
      // ];
      // function drawLocation (location, opts) {
      //   if (typeof opts !== 'object') {
      //     opts = {}
      //   }
      //   opts.position = new google.maps.LatLng(location[0], location[1]);
      //   opts.map = map;
      //   var marker = new google.maps.Marker(opts);
      // }
      // drawLocation(hotelLocation, {
      //   icon: '/images/lodging_0star.png'
      // });
      // restaurantLocations.forEach(function (loc) {
      //   drawLocation(loc, {
      //     icon: '/images/restaurant.png'
      //   });
      // });
      // activityLocations.forEach(function (loc) {
      //   drawLocation(loc, {
      //     icon: '/images/star-3.png'
      //   });
      // });
    }

    $(document).ready(function() {
      initialize_gmaps();
      var days = {};
      var current = 0;
      var numDays = 0;
      $(document).on("click",".add", function(){
        if(current === 0){
          console.log("Na");
          return;
        }
        var type = $(this).siblings("h4")[0].innerText;
        if(type === "Hotels") type = "Hotel";
        var option = $(this).siblings("select")[0].selectedOptions[0].outerText;
        var hotels = $(".current")[0]//.childNodes[3]//.childNodes[3]//.childNodes[0];
        var restaurants = $(".current")//[0].childNodes[3]//.childNodes[3]//.childNodes//[1];
        var activities = $(".current")//[0].childNodes[3]//.childNodes[3]//.childNodes//[2];
        console.dir("Hotels", hotels);
        console.dir("Restaurants",restaurants);
        console.dir("Activities",activities);
        var hotelName = hotels.childNodes[1].innerText.slice(3);
        var restaurantName = restaurants.childNodes[1].innerText.slice(3);
        var activityName = activities.childNodes[1].innerText.slice(3);
        if(type === hotelName){
            var length = hotels.childNodes[1].childNodes.length;
            if(length < 1){
              var html = '<div class="itinerary-item"><span class="title">' + option +'</span><button class="btn btn-xs btn-danger remove btn-circle">x</button></div>'
              console.dir($(hotels.childNodes[1]));
              $(hotels.childNodes[1]).append(html);
              days[(current-1).toString()]["hotels"]+= html;

            }
        }else if(type === restaurantName){
            var length = restaurants.childNodes[1].childNodes.length;
            if(length < 3){
              var html = '<div class="itinerary-item"><span class="title">' + option +'</span><button class="btn btn-xs btn-danger remove btn-circle">x</button></div>'
              console.dir($(restaurants.childNodes[1]));
              $(restaurants.childNodes[1]).append(html);
              days[(current-1).toString()]["restaurants"]+=html;
            }
        }else if(type === activityName){
            var length = activities.childNodes[1].childNodes.length;
            if(length < 2){
              var html = '<div class="itinerary-item"><span class="title">' + option +'</span><button class="btn btn-xs btn-danger remove btn-circle">x</button></div>'
              console.dir($(activities.childNodes[1]));
              $(activities.childNodes[1]).append(html);
              days[(current-1).toString()]["activities"]+=html;
            }
        }
      });
      $(document).on("click", ".remove", function(){
        $(this).parent().remove()
      });

      $(document).on("click", ".add-day", function(){
        if($(this).prev()[0] == undefined) var dayNum = 1;
        else var dayNum = parseInt($(this).prev()[0].innerText)+1;
        var last = '<button class="btn btn-circle day-btn">'+dayNum+'</button>';
        var addDay = '<button class="btn btn-circle add-day">+</button>'
        var dayInfo = '<div class="panel-body day-info"><div><h4>My Hotel</h4><ul class="list-group"></ul></div><div><h4>My Restaurants</h4><ul class="list-group"></ul></div><div><h4>My Activities</h4><ul class="list-group"></ul></div></div>'
        var parent = $(this).parent();
        $(this).remove();
        parent.append(last + " " + addDay);
        days[numDays.toString()] = {"activities":'<div><h4>My Activities</h4><ul class="list-group">',"restaurants":'<div><h4>My Restaurants</h4><ul class="list-group">',"hotels":'<div><h4>My Hotels</h4><ul class="list-group">'};
        numDays++;
      });

      $(document).on("click", ".day-btn", function(){
        console.dir(this);
        console.log("Inner",this.innerText)
        var num = parseInt(this.innerText);
        current = num;
        console.log("Current", current);
        var currentDay = days[(current - 1).toString()];
        console.log(current);
        var answer = currentDay["hotels"] + '</ul></div>' + currentDay["restaurants"] + '</ul></div>' + currentDay["activities"] + '</ul></div>'
        console.log("Answer", answer);
        $(".day-info").html(answer);
        $("#day-title")[0].firstElementChild.innerText = "Day " + current.toString();
      });
    });

    var styleArr = [{
      featureType: "landscape",
      stylers: [{
        saturation: -100
      }, {
        lightness: 60
      }]
    }, {
      featureType: "road.local",
      stylers: [{
        saturation: -100
      }, {
        lightness: 40
      }, {
        visibility: "on"
      }]
    }, {
      featureType: "transit",
      stylers: [{
        saturation: -100
      }, {
        visibility: "simplified"
      }]
    }, {
      featureType: "administrative.province",
      stylers: [{
        visibility: "off"
      }]
    }, {
      featureType: "water",
      stylers: [{
        visibility: "on"
      }, {
        lightness: 30
      }]
    }, {
      featureType: "road.highway",
      elementType: "geometry.fill",
      stylers: [{
        color: "#ef8c25"
      }, {
        lightness: 40
      }]
    }, {
      featureType: "road.highway",
      elementType: "geometry.stroke",
      stylers: [{
        visibility: "off"
      }]
    }, {
      featureType: "poi.park",
      elementType: "geometry.fill",
      stylers: [{
        color: "#b6c54c"
      }, {
        lightness: 40
      }, {
        saturation: -40
      }]
    }];
  </script>
  </body>
</html>
